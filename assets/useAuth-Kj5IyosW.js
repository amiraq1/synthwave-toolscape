import{r as n}from"./react-core-DF6eTxSH.js";import{s as r}from"./client-BQnz2r4z.js";const p="nabd_return_to",I=()=>{const[i,c]=n.useState({user:null,session:null,loading:!0}),u=n.useRef(!1),a=n.useRef(!1),o=n.useCallback(e=>{if(!u.current)return;const t=e??null;c({session:t,user:t?.user??null,loading:!1})},[]);n.useEffect(()=>{u.current=!0,a.current=!1;const{data:{subscription:e}}=r.auth.onAuthStateChange((t,s)=>{if(!a.current){a.current=!0,o(s);return}t!=="INITIAL_SESSION"&&o(s)});return(async()=>{const{data:t,error:s}=await r.auth.getSession();u.current&&(a.current||(a.current=!0,o(s?null:t.session??null)))})(),()=>{u.current=!1,e.unsubscribe()}},[o]);const l=n.useCallback(async(e,t,s)=>{const h=`${window.location.origin}/`,{error:w}=await r.auth.signUp({email:e,password:t,options:{emailRedirectTo:h,data:{display_name:s}}});return{error:w}},[]),f=n.useCallback(async(e,t)=>{const{error:s}=await r.auth.signInWithPassword({email:e,password:t});return{error:s}},[]),g=n.useCallback(async()=>{try{const s=new URL(window.location.href);s.hash="",sessionStorage.setItem(p,s.toString())}catch{}const e=`${window.location.origin}/auth/callback`,{error:t}=await r.auth.signInWithOAuth({provider:"google",options:{redirectTo:e}});return{error:t}},[]),d=n.useCallback(async()=>{const{error:e}=await r.auth.signOut();return{error:e}},[]);return{user:i.user,session:i.session,loading:i.loading,signUp:l,signIn:f,signInWithGoogle:g,signOut:d}};export{I as u};
