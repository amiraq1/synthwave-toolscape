import{r as g,j as r}from"./react-core-DF6eTxSH.js";import{B as y}from"./badge-CHfEu4tN.js";import{B}from"./button-C_lhRWi6.js";import{b as $,a as D}from"./useClickTracking-rGkldF14.js";import{u as I,b as F,c as P}from"./tanstack-C82ICjHp.js";import{s as w}from"./client-BQnz2r4z.js";import{u as T}from"./useAuth-Kj5IyosW.js";import{u as K,c as o}from"./index-DsAfhvWl.js";import{b as U}from"./router-6Sp3h7Hu.js";import{_ as A,$ as Q,Z as V,a0 as G,a1 as H,K as O,a2 as Z,S as W,a3 as Y,a4 as J,Y as X,a5 as ee,j as re,h as ae,E as te,f as se}from"./icons-D1KRm4qg.js";const oe=()=>{const{user:e}=T(),{toast:t}=K(),i=F(),{data:u=[],isLoading:b}=I({queryKey:["bookmarks",e?.id],queryFn:async()=>{if(!e)return[];const{data:a,error:s}=await w.from("bookmarks").select("tool_id").eq("user_id",e.id);if(s)throw s;return a},enabled:!!e}),l=u.map(a=>a.tool_id),m=a=>{const s=typeof a=="string"?parseInt(a,10):a;return l.includes(s)},c=P({mutationFn:async a=>{if(!e)throw new Error("User not authenticated");const s=typeof a=="string"?parseInt(a,10):a;if(m(s)){const{error:p}=await w.from("bookmarks").delete().eq("user_id",e.id).eq("tool_id",s);if(p)throw p;return{action:"removed",toolId:s}}else{const{error:p}=await w.from("bookmarks").insert({user_id:e.id,tool_id:s});if(p)throw p;return{action:"added",toolId:s}}},onSuccess:a=>{i.invalidateQueries({queryKey:["bookmarks"]}),t({title:a.action==="added"?"â¤ï¸ ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©":"ðŸ’” ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©",className:a.action==="added"?"bg-rose-500/10 text-rose-500":"bg-muted text-muted-foreground"})},onError:()=>{t({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØ¶Ù„Ø©",variant:"destructive"})}});return{bookmarkedToolIds:l,isBookmarked:m,toggleBookmark:c.mutate,isToggling:c.isPending,isLoading:b}},we=()=>{const{user:e}=T();return I({queryKey:["bookmarked-tools",e?.id],queryFn:async()=>{if(!e)return[];const{data:t,error:i}=await w.from("bookmarks").select("tool_id").eq("user_id",e.id);if(i)throw i;if(!t||t.length===0)return[];const u=t.map(m=>m.tool_id),{data:b,error:l}=await w.from("tools").select("*").in("id",u);if(l)throw l;return b||[]},enabled:!!e})},ne=({src:e,alt:t,className:i,placeholderClassName:u,onError:b,width:l,height:m,priority:c=!1})=>{const[a,s]=g.useState(!1),[k,p]=g.useState(c),[E,x]=g.useState(!1),n=g.useRef(null);g.useEffect(()=>{if(c)return;const h=new IntersectionObserver(([f])=>{f.isIntersecting&&(p(!0),h.disconnect())},{rootMargin:"200px",threshold:.01});return n.current&&h.observe(n.current),()=>h.disconnect()},[c]);const v=()=>{s(!0)},C=()=>{x(!0),b?.()};if(E)return null;const j=e&&!e.includes("wikimedia.org")?e:"";return r.jsxs("div",{ref:n,className:o("relative",i),style:{width:l?`${l}px`:void 0,height:m?`${m}px`:void 0},children:[r.jsx("div",{className:o("absolute inset-0 bg-muted animate-pulse rounded-lg transition-opacity duration-300",u,a?"opacity-0":"opacity-100"),"aria-hidden":"true"}),k&&j&&r.jsx("img",{src:j,alt:t,width:l,height:m,loading:c?"eager":"lazy",decoding:c?"sync":"async",fetchPriority:c?"high":"auto",onLoad:v,onError:C,className:o("w-full h-full object-contain transition-opacity duration-300",a?"opacity-100":"opacity-0")})]})},ie={Ù†ØµÙˆØµ:Z,ØµÙˆØ±:O,ÙÙŠØ¯ÙŠÙˆ:H,Ø¨Ø±Ù…Ø¬Ø©:G,Ø¥Ù†ØªØ§Ø¬ÙŠØ©:V,ØµÙˆØª:Q,Ø§Ù„ÙƒÙ„:A},le={Ù†ØµÙˆØµ:"from-emerald-500/20 to-teal-600/20 text-emerald-400 border-emerald-500/20",ØµÙˆØ±:"from-purple-500/20 to-pink-600/20 text-purple-400 border-purple-500/20",ÙÙŠØ¯ÙŠÙˆ:"from-blue-500/20 to-cyan-600/20 text-blue-400 border-blue-500/20",Ø¨Ø±Ù…Ø¬Ø©:"from-orange-500/20 to-red-600/20 text-orange-400 border-orange-500/20",Ø¥Ù†ØªØ§Ø¬ÙŠØ©:"from-yellow-500/20 to-amber-600/20 text-yellow-400 border-yellow-500/20",ØµÙˆØª:"from-rose-500/20 to-pink-600/20 text-rose-400 border-rose-500/20"},ce=({rating:e,count:t})=>{const i=typeof e=="number"&&!Number.isNaN(e)?e:0,u=typeof t=="number"&&!Number.isNaN(t)?t:0;return r.jsxs("div",{className:"flex items-center gap-1.5 bg-black/20 px-2 py-1 rounded-md border border-white/5 backdrop-blur-sm",children:[r.jsx(se,{className:"w-3.5 h-3.5 fill-amber-400 text-amber-400"}),r.jsx("span",{className:"text-sm font-semibold tabular-nums text-white/90",children:i.toFixed(1)}),r.jsxs("span",{className:"text-xs text-white/40 hidden sm:inline",children:["(",u,")"]})]})},ke=({tool:e,index:t})=>{const i=U(),u=$(),{user:b}=T(),{isBookmarked:l,toggleBookmark:m,isToggling:c}=oe(),[a,s]=g.useState(!1),{recordClick:k}=D(),p=le[e.category]||"from-gray-500/20 to-gray-600/20 text-gray-400 border-gray-500/20",E=ie[e.category]||W,x=l(e.id),n=e.is_sponsored===!0,v=e.supports_arabic===!0,C=!!e.coupon_code&&(!e.deal_expiry||new Date(e.deal_expiry)>new Date),j=g.useMemo(()=>{if(!e.release_date)return!1;const d=new Date(e.release_date);return Math.floor((Date.now()-d.getTime())/(1e3*60*60*24))<=30},[e.release_date]),h=e.is_featured===!0||e.clicks_count&&e.clicks_count>1e3,f=e.arabic_score??(v?7:0),z=()=>{i(`/tool/${e.id}`)},q=d=>{d.stopPropagation(),k(e.id)},L=()=>{u(e.id)},M=d=>{if(d.stopPropagation(),!b){i("/auth");return}m(e.id)},R=d=>{try{return`https://www.google.com/s2/favicons?domain=${new URL(d).hostname}&sz=128`}catch{return null}},N=e.image_url&&!a,S=N?null:R(e.url);return r.jsxs("article",{onClick:z,onMouseEnter:L,className:o("group relative flex flex-col h-full rounded-2xl p-5 transition-all duration-300 hover:translate-y-[-4px] backdrop-blur-sm cursor-pointer overflow-hidden",n?"bg-gradient-to-br from-amber-500/5 to-yellow-600/5 border-2 border-amber-500/40 hover:border-amber-400/60 shadow-[0_0_20px_-5px_rgba(245,158,11,0.25)] hover:shadow-[0_0_30px_-5px_rgba(245,158,11,0.4)]":"bg-card/30 hover:bg-card/50 border border-white/5 hover:border-white/10 hover:shadow-2xl hover:shadow-neon-purple/5"),style:{animationDelay:`${Math.min(t,6)*50}ms`},dir:"rtl",children:[n&&r.jsx("div",{className:"absolute top-3 right-3 z-20",children:r.jsxs(y,{className:"bg-gradient-to-r from-amber-500 to-yellow-500 text-black font-bold text-[10px] px-2 py-0.5 border-0 gap-1",children:[r.jsx(Y,{className:"w-3 h-3"}),"Ù…Ù…ÙˆÙ„"]})}),j&&!n&&r.jsx("div",{className:"absolute top-3 right-3 z-20",children:r.jsxs(y,{className:"bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold text-[10px] px-2 py-0.5 border-0 gap-1 animate-pulse shadow-[0_0_10px_rgba(20,184,166,0.5)]",children:[r.jsx(J,{className:"w-3 h-3"}),"Ø¬Ø¯ÙŠØ¯"]})}),r.jsx(B,{variant:"ghost",size:"icon",onClick:M,disabled:c,"aria-label":x?"Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©":"Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©",className:o("absolute top-3 left-3 z-20 h-9 w-9 rounded-full backdrop-blur-sm transition-all",x?"bg-rose-500/20 text-rose-500 hover:bg-rose-500/30":"bg-black/20 text-white/50 hover:text-rose-500 hover:bg-rose-500/10 opacity-0 group-hover:opacity-100"),children:r.jsx(X,{className:o("w-4 h-4",x&&"fill-current")})}),r.jsxs("div",{className:"flex items-start gap-4 mb-4 z-10",children:[r.jsxs("div",{className:o("w-14 h-14 sm:w-16 sm:h-16 rounded-2xl flex items-center justify-center shrink-0 transition-all duration-500 group-hover:scale-105 group-hover:rotate-3 shadow-lg overflow-hidden","border backdrop-blur-md",n?"border-amber-500/30 bg-gradient-to-br from-amber-500/10 to-yellow-600/10":N?"bg-white/10 border-white/10":`bg-gradient-to-br ${p}`),children:[N?r.jsx(ne,{src:e.image_url,alt:e.title,width:64,height:64,className:"w-full h-full p-2 rounded-2xl object-contain",onError:()=>s(!0)}):S?r.jsx("img",{src:S,alt:e.title,className:"w-8 h-8 sm:w-9 sm:h-9 object-contain opacity-90 group-hover:opacity-100 transition-opacity",loading:"lazy",onError:d=>{d.currentTarget.style.display="none",d.currentTarget.parentElement?.querySelector(".fallback-icon")?.classList.remove("hidden")}}):null,r.jsx("div",{className:o("fallback-icon absolute inset-0 flex items-center justify-center",N||S?"hidden":"flex"),children:r.jsx(E,{className:"w-7 h-7 sm:w-8 sm:h-8 opacity-90",strokeWidth:1.5})})]}),r.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[r.jsx("h3",{className:o("text-lg font-bold transition-colors truncate",n?"text-amber-100 group-hover:text-amber-300":"text-white group-hover:text-neon-purple"),children:e.title}),h&&r.jsx("span",{className:"flex items-center gap-0.5 text-orange-400",title:"Ø±Ø§Ø¦Ø¬",children:r.jsx(ee,{className:"w-4 h-4 fill-orange-400 animate-pulse"})}),e.is_featured&&!n&&!h&&r.jsxs("span",{className:"flex h-2 w-2",children:[r.jsx("span",{className:"animate-ping absolute inline-flex h-2 w-2 rounded-full bg-neon-cyan opacity-75"}),r.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-neon-cyan"})]})]}),r.jsx(y,{variant:"secondary",className:"bg-white/5 hover:bg-white/10 text-muted-foreground font-normal border-0 text-xs px-2",children:e.category}),(v||f>0)&&r.jsx("div",{className:"flex items-center gap-1",children:r.jsxs(y,{className:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20 text-[10px] px-1.5 py-0 gap-1",children:[r.jsx(re,{className:"w-2.5 h-2.5"}),"Ø¹Ø±Ø¨ÙŠ",f>0&&r.jsx("span",{className:"flex gap-0.5 mr-1",children:[...Array(5)].map((d,_)=>r.jsx("span",{className:o("w-1 h-2 rounded-sm",_<Math.ceil(f/2)?"bg-emerald-400":"bg-emerald-400/20")},_))})]})}),C&&r.jsxs(y,{className:"bg-rose-500/10 text-rose-400 border-rose-500/20 text-[10px] px-1.5 py-0 gap-0.5 animate-pulse",children:[r.jsx(ae,{className:"w-2.5 h-2.5"}),"Ø¹Ø±Ø¶"]})]})]}),r.jsx("p",{className:"text-muted-foreground/80 text-sm leading-relaxed line-clamp-2 mb-5 flex-1 z-10",children:e.description}),r.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/5 mt-auto z-10",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(ce,{rating:e.average_rating,count:e.reviews_count}),r.jsx("span",{className:o("text-xs font-medium px-2 py-0.5 rounded-full border",e.pricing_type==="Ù…Ø¬Ø§Ù†ÙŠ"?"text-emerald-400 border-emerald-500/20 bg-emerald-500/5":"text-amber-400 border-amber-500/20 bg-amber-500/5"),children:e.pricing_type})]}),r.jsx(B,{asChild:!0,size:"icon",variant:"ghost",className:o("h-8 w-8 rounded-full transition-colors",n?"hover:bg-amber-500/20 hover:text-amber-400 text-muted-foreground":"hover:bg-neon-purple/20 hover:text-neon-purple text-muted-foreground"),onClick:q,children:r.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer","aria-label":`Ø²ÙŠØ§Ø±Ø© Ù…ÙˆÙ‚Ø¹ ${e.title}`,children:r.jsx(te,{className:"h-4 w-4"})})})]}),r.jsx("div",{className:o("absolute -right-10 -top-10 w-32 h-32 rounded-full blur-[60px] opacity-0 group-hover:opacity-20 transition-opacity duration-500 pointer-events-none",n?"bg-amber-500":e.category==="Ø¨Ø±Ù…Ø¬Ø©"?"bg-orange-500":"bg-neon-purple")})]})};export{ke as T,we as u};
