import{r as e,E as s,j as t,a5 as r,a9 as a,a7 as n}from"./react-vendor-DJsICmPt.js";import{B as o}from"./button-DbulzYd5.js";import{I as i}from"./input-Fa_FmzDN.js";import{L as l}from"./label-DiJ43kGo.js";import{u as d}from"./index-CmycUjlN.js";import{s as c}from"./client-BiGFyOmG.js";import{a5 as m,a6 as u}from"./vendor-Duk2WWTq.js";import"./ui-vendor-BpqZfnrR.js";import"./supabase-vendor-CtVNLq9t.js";const p=m({password:u().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),confirmPassword:u()}).refine(e=>e.password===e.confirmPassword,{message:"كلمتا المرور غير متطابقتين",path:["confirmPassword"]});const x=()=>{const[m,u]=e.useState(""),[x,h]=e.useState(""),[f,j]=e.useState(!1),[g,v]=e.useState(!0),[w,b]=e.useState(!1),N=s(),{toast:y}=d(),k=e.useMemo(()=>function(){var e;const s=new URL(window.location.href),t=s.searchParams.get("code"),r=(null==(e=s.hash)?void 0:e.startsWith("#"))?s.hash.substring(1):s.hash,a=new URLSearchParams(r||"");return{code:t,accessToken:a.get("access_token"),refreshToken:a.get("refresh_token"),type:a.get("type")}}(),[]);e.useEffect(()=>{let e=!1;return(async()=>{try{if(k.code){const{error:e}=await c.auth.exchangeCodeForSession(k.code);if(e)return y({title:"رابط غير صالح",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),void N("/auth",{replace:!0})}const{data:e}=await c.auth.getSession();if(!e.session)return y({title:"رابط غير صالح",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),void N("/auth",{replace:!0})}finally{e||v(!1)}})(),()=>{e=!0}},[N,y,k.code]);return g?t.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",dir:"rtl",children:t.jsx("div",{className:"w-full max-w-md",children:t.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 text-center space-y-4",children:[t.jsx(r,{className:"mx-auto h-10 w-10 text-neon-purple animate-pulse"}),t.jsx("p",{className:"text-muted-foreground",children:"جاري التحقق من رابط إعادة التعيين…"})]})})}):w?t.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center px-4 py-6",dir:"rtl",children:[t.jsx("div",{className:"fixed top-0 left-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-purple/20 rounded-full blur-[120px] -z-10"}),t.jsx("div",{className:"fixed bottom-0 right-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-blue/20 rounded-full blur-[120px] -z-10"}),t.jsx("div",{className:"w-full max-w-md",children:t.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 space-y-8 text-center",children:[t.jsx("div",{className:"flex justify-center",children:t.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-neon-purple to-neon-blue flex items-center justify-center",children:t.jsx(a,{className:"h-10 w-10 text-foreground"})})}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"تم تغيير كلمة المرور!"}),t.jsx("p",{className:"text-muted-foreground",children:"يمكنك الآن تسجيل الدخول باستخدام كلمة المرور الجديدة"})]}),t.jsx(o,{onClick:()=>N("/auth",{replace:!0}),className:"w-full bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 transition-opacity py-6 text-lg",children:"تسجيل الدخول"}),t.jsx("button",{type:"button",onClick:()=>N("/",{replace:!0}),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"العودة للصفحة الرئيسية"})]})})]}):t.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center px-4 py-6",dir:"rtl",children:[t.jsx("div",{className:"fixed top-0 left-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-purple/20 rounded-full blur-[120px] -z-10"}),t.jsx("div",{className:"fixed bottom-0 right-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-blue/20 rounded-full blur-[120px] -z-10"}),t.jsx("div",{className:"w-full max-w-md",children:t.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 space-y-8",children:[t.jsxs("div",{className:"text-center space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(r,{className:"h-10 w-10 text-neon-purple animate-pulse"}),t.jsxs("h1",{className:"text-3xl",children:[t.jsx("span",{className:"font-extrabold gradient-text",children:"نبض"}),t.jsx("span",{className:"font-medium text-foreground/80 mr-1",children:"AI"})]})]}),t.jsx("p",{className:"text-muted-foreground",children:"إنشاء كلمة مرور جديدة"})]}),t.jsxs("form",{onSubmit:async e=>{e.preventDefault(),j(!0);try{const e=p.safeParse({password:m,confirmPassword:x});if(!e.success)return void y({title:"خطأ في البيانات",description:e.error.errors[0].message,variant:"destructive"});const{data:s}=await c.auth.getSession();if(!s.session)return y({title:"انتهت صلاحية الرابط",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),void N("/auth",{replace:!0});const{error:t}=await c.auth.updateUser({password:m});if(t)return void y({title:"خطأ",description:"حدث خطأ أثناء تغيير كلمة المرور",variant:"destructive"});b(!0),y({title:"تم بنجاح!",description:"تم تغيير كلمة المرور بنجاح"})}finally{j(!1)}},className:"space-y-6",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(l,{htmlFor:"password",children:"كلمة المرور الجديدة"}),t.jsxs("div",{className:"relative",children:[t.jsx(n,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),t.jsx(i,{id:"password",type:"password",placeholder:"••••••••",value:m,onChange:e=>u(e.target.value),className:"pr-10 bg-muted/50 border-border/50",required:!0,autoComplete:"new-password"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(l,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور"}),t.jsxs("div",{className:"relative",children:[t.jsx(n,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),t.jsx(i,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:x,onChange:e=>h(e.target.value),className:"pr-10 bg-muted/50 border-border/50",required:!0,autoComplete:"new-password"})]})]}),t.jsx(o,{type:"submit",disabled:f,className:"w-full bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 transition-opacity py-6 text-lg",children:f?"جاري الحفظ...":"حفظ كلمة المرور"})]}),t.jsx("div",{className:"text-center",children:t.jsx("button",{type:"button",onClick:()=>N("/",{replace:!0}),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"العودة للصفحة الرئيسية"})})]})})]})};export{x as default};
