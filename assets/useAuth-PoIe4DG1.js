import{r}from"./react-core-Ds-4081u.js";import{s as n}from"./client-CroYBHHp.js";const s=()=>{const[s,t]=r.useState({user:null,session:null,loading:!0}),e=r.useRef(!1),o=r.useRef(!1),a=r.useCallback(r=>{if(!e.current)return;const n=r??null;t({session:n,user:n?.user??null,loading:!1})},[]);r.useEffect(()=>{e.current=!0,o.current=!1;const{data:{subscription:r}}=n.auth.onAuthStateChange((r,n)=>{if(!o.current)return o.current=!0,void a(n);"INITIAL_SESSION"!==r&&a(n)});return(async()=>{const{data:r,error:s}=await n.auth.getSession();e.current&&(o.current||(o.current=!0,a(s?null:r.session??null)))})(),()=>{e.current=!1,r.unsubscribe()}},[a]);const i=r.useCallback(async(r,s,t)=>{const e=`${window.location.origin}/`,{error:o}=await n.auth.signUp({email:r,password:s,options:{emailRedirectTo:e,data:{display_name:t}}});return{error:o}},[]),u=r.useCallback(async(r,s)=>{const{error:t}=await n.auth.signInWithPassword({email:r,password:s});return{error:t}},[]),c=r.useCallback(async()=>{try{const r=new URL(window.location.href);r.hash="",sessionStorage.setItem("nabd_return_to",r.toString())}catch{}const r=`${window.location.origin}/auth/callback`,{error:s}=await n.auth.signInWithOAuth({provider:"google",options:{redirectTo:r}});return{error:s}},[]),l=r.useCallback(async()=>{const{error:r}=await n.auth.signOut();return{error:r}},[]);return{user:s.user,session:s.session,loading:s.loading,signUp:i,signIn:u,signInWithGoogle:c,signOut:l}};export{s as u};
