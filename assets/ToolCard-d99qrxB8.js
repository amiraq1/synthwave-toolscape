import{u as e,v as r,w as t,r as a,j as o,aL as s,aM as i,Z as n,aN as l,aO as d,au as c,aP as m,S as u,aQ as p,aR as b,aK as h,aS as x,J as g,H as f,W as w,y}from"./react-core-Ds-4081u.js";import{B as j}from"./badge-DTtQ13UM.js";import{B as v}from"./button-0HSBgZKY.js";import{b as N,a as k}from"./useClickTracking-Bxso9kx1.js";import{s as _}from"./client-CroYBHHp.js";import{u as q}from"./useAuth-PoIe4DG1.js";import{u as z,c as E}from"./index-CoeHQGik.js";import{b as S}from"./react-router-BmNS8iat.js";const C=()=>{const{user:r}=q();return e({queryKey:["bookmarked-tools",r?.id],queryFn:async()=>{if(!r)return[];const{data:e,error:t}=await _.from("bookmarks").select("tool_id").eq("user_id",r.id);if(t)throw t;if(!e||0===e.length)return[];const a=e.map(e=>e.tool_id),{data:o,error:s}=await _.from("tools").select("*").in("id",a);if(s)throw s;return(o||[]).map(e=>({...e,id:String(e.id)}))},enabled:!!r})},T=({src:e,alt:r,className:t,placeholderClassName:s,onError:i,width:n,height:l,priority:d=!1})=>{const[c,m]=a.useState(!1),[u,p]=a.useState(d),[b,h]=a.useState(!1),x=a.useRef(null);a.useEffect(()=>{if(d)return;const e=new IntersectionObserver(([r])=>{r.isIntersecting&&(p(!0),e.disconnect())},{rootMargin:"200px",threshold:.01});return x.current&&e.observe(x.current),()=>e.disconnect()},[d]);if(b)return null;const g=e&&!e.includes("wikimedia.org")?e:"";return o.jsxs("div",{ref:x,className:E("relative",t),style:{width:n?`${n}px`:void 0,height:l?`${l}px`:void 0},children:[o.jsx("div",{className:E("absolute inset-0 bg-muted animate-pulse rounded-lg transition-opacity duration-300",s,c?"opacity-0":"opacity-100"),"aria-hidden":"true"}),u&&g&&o.jsx("img",{src:g,alt:r,width:n,height:l,loading:d?"eager":"lazy",decoding:d?"sync":"async",fetchPriority:d?"high":"auto",onLoad:()=>{m(!0)},onError:()=>{h(!0),i?.()},className:E("w-full h-full object-contain transition-opacity duration-300",c?"opacity-100":"opacity-0")})]})},I={"Ù†ØµÙˆØµ":m,"ØµÙˆØ±":c,"ÙÙŠØ¯ÙŠÙˆ":d,"Ø¨Ø±Ù…Ø¬Ø©":l,"Ø¥Ù†ØªØ§Ø¬ÙŠØ©":n,"ØµÙˆØª":i,"Ø§Ù„ÙƒÙ„":s},M={"Ù†ØµÙˆØµ":"from-emerald-500/20 to-teal-600/20 text-emerald-400 border-emerald-500/20","ØµÙˆØ±":"from-purple-500/20 to-pink-600/20 text-purple-400 border-purple-500/20","ÙÙŠØ¯ÙŠÙˆ":"from-blue-500/20 to-cyan-600/20 text-blue-400 border-blue-500/20","Ø¨Ø±Ù…Ø¬Ø©":"from-orange-500/20 to-red-600/20 text-orange-400 border-orange-500/20","Ø¥Ù†ØªØ§Ø¬ÙŠØ©":"from-yellow-500/20 to-amber-600/20 text-yellow-400 border-yellow-500/20","ØµÙˆØª":"from-rose-500/20 to-pink-600/20 text-rose-400 border-rose-500/20"},B=({rating:e,count:r})=>{const t="number"!=typeof e||Number.isNaN(e)?0:e,a="number"!=typeof r||Number.isNaN(r)?0:r;return o.jsxs("div",{className:"flex items-center gap-1.5 bg-black/20 px-2 py-1 rounded-md border border-white/5 backdrop-blur-sm",children:[o.jsx(y,{className:"w-3.5 h-3.5 fill-amber-400 text-amber-400"}),o.jsx("span",{className:"text-sm font-semibold tabular-nums text-white/90",children:t.toFixed(1)}),o.jsxs("span",{className:"text-xs text-white/40 hidden sm:inline",children:["(",a,")"]})]})},L=({tool:s,index:i})=>{const n=S(),l=N(),{user:d}=q(),{isBookmarked:c,toggleBookmark:m,isToggling:y}=(()=>{const{user:a}=q(),{toast:o}=z(),s=r(),{data:i=[],isLoading:n}=e({queryKey:["bookmarks",a?.id],queryFn:async()=>{if(!a)return[];const{data:e,error:r}=await _.from("bookmarks").select("tool_id").eq("user_id",a.id);if(r)throw r;return e},enabled:!!a}),l=i.map(e=>e.tool_id),d=e=>{const r="string"==typeof e?parseInt(e,10):e;return l.includes(r)},c=t({mutationFn:async e=>{if(!a)throw new Error("User not authenticated");const r="string"==typeof e?parseInt(e,10):e;if(d(r)){const{error:e}=await _.from("bookmarks").delete().eq("user_id",a.id).eq("tool_id",r);if(e)throw e;return{action:"removed",toolId:r}}{const{error:e}=await _.from("bookmarks").insert({user_id:a.id,tool_id:r});if(e)throw e;return{action:"added",toolId:r}}},onSuccess:e=>{s.invalidateQueries({queryKey:["bookmarks"]}),o({title:"added"===e.action?"â¤ï¸ ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©":"ðŸ’” ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©",className:"added"===e.action?"bg-rose-500/10 text-rose-500":"bg-muted text-muted-foreground"})},onError:()=>{o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØ¶Ù„Ø©",variant:"destructive"})}});return{bookmarkedToolIds:l,isBookmarked:d,toggleBookmark:c.mutate,isToggling:c.isPending,isLoading:n}})(),[C,L]=a.useState(!1),{recordClick:$}=k(),D=M[s.category]||"from-gray-500/20 to-gray-600/20 text-gray-400 border-gray-500/20",P=I[s.category]||u,F=c(s.id),K=!0===s.is_sponsored,A=!0===s.supports_arabic,R=!!s.coupon_code&&(!s.deal_expiry||new Date(s.deal_expiry)>new Date),O=a.useMemo(()=>{if(!s.release_date)return!1;const e=new Date(s.release_date);return Math.floor((Date.now()-e.getTime())/864e5)<=30},[s.release_date]),Q=!0===s.is_featured||s.clicks_count&&s.clicks_count>1e3,U=s.arabic_score??(A?7:0),W=s.image_url&&!C,H=W?null:(e=>{try{return`https://www.google.com/s2/favicons?domain=${new URL(e).hostname}&sz=128`}catch{return null}})(s.url);return o.jsxs("article",{onClick:()=>{n(`/tool/${s.id}`)},onMouseEnter:()=>{l(s.id)},className:E("group relative flex flex-col h-full rounded-2xl p-5 transition-all duration-300 hover:translate-y-[-4px] backdrop-blur-sm cursor-pointer overflow-hidden",K?"bg-gradient-to-br from-amber-500/5 to-yellow-600/5 border-2 border-amber-500/40 hover:border-amber-400/60 shadow-[0_0_20px_-5px_rgba(245,158,11,0.25)] hover:shadow-[0_0_30px_-5px_rgba(245,158,11,0.4)]":"bg-card/30 hover:bg-card/50 border border-white/5 hover:border-white/10 hover:shadow-2xl hover:shadow-neon-purple/5"),style:{animationDelay:50*Math.min(i,6)+"ms"},dir:"rtl",children:[K&&o.jsx("div",{className:"absolute top-3 right-3 z-20",children:o.jsxs(j,{className:"bg-gradient-to-r from-amber-500 to-yellow-500 text-black font-bold text-[10px] px-2 py-0.5 border-0 gap-1",children:[o.jsx(p,{className:"w-3 h-3"}),"Ù…Ù…ÙˆÙ„"]})}),O&&!K&&o.jsx("div",{className:"absolute top-3 right-3 z-20",children:o.jsxs(j,{className:"bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold text-[10px] px-2 py-0.5 border-0 gap-1 animate-pulse shadow-[0_0_10px_rgba(20,184,166,0.5)]",children:[o.jsx(b,{className:"w-3 h-3"}),"Ø¬Ø¯ÙŠØ¯"]})}),o.jsx(v,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),d?m(s.id):n("/auth")},disabled:y,"aria-label":F?"Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©":"Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©",className:E("absolute top-3 left-3 z-20 h-9 w-9 rounded-full backdrop-blur-sm transition-all",F?"bg-rose-500/20 text-rose-500 hover:bg-rose-500/30":"bg-black/20 text-white/50 hover:text-rose-500 hover:bg-rose-500/10 opacity-0 group-hover:opacity-100"),children:o.jsx(h,{className:E("w-4 h-4",F&&"fill-current")})}),o.jsxs("div",{className:"flex items-start gap-4 mb-4 z-10",children:[o.jsxs("div",{className:E("w-14 h-14 sm:w-16 sm:h-16 rounded-2xl flex items-center justify-center shrink-0 transition-all duration-500 group-hover:scale-105 group-hover:rotate-3 shadow-lg overflow-hidden","border backdrop-blur-md",K?"border-amber-500/30 bg-gradient-to-br from-amber-500/10 to-yellow-600/10":W?"bg-white/10 border-white/10":`bg-gradient-to-br ${D}`),children:[W?o.jsx(T,{src:s.image_url,alt:s.title,width:64,height:64,className:"w-full h-full p-2 rounded-2xl object-contain",onError:()=>L(!0)}):H?o.jsx("img",{src:H,alt:s.title,className:"w-8 h-8 sm:w-9 sm:h-9 object-contain opacity-90 group-hover:opacity-100 transition-opacity",loading:"lazy",onError:e=>{e.currentTarget.style.display="none",e.currentTarget.parentElement?.querySelector(".fallback-icon")?.classList.remove("hidden")}}):null,o.jsx("div",{className:E("fallback-icon absolute inset-0 flex items-center justify-center",W||H?"hidden":"flex"),children:o.jsx(P,{className:"w-7 h-7 sm:w-8 sm:h-8 opacity-90",strokeWidth:1.5})})]}),o.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[o.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[o.jsx("h3",{className:E("text-lg font-bold transition-colors truncate",K?"text-amber-100 group-hover:text-amber-300":"text-white group-hover:text-neon-purple"),children:s.title}),Q&&o.jsx("span",{className:"flex items-center gap-0.5 text-orange-400",title:"Ø±Ø§Ø¦Ø¬",children:o.jsx(x,{className:"w-4 h-4 fill-orange-400 animate-pulse"})}),s.is_featured&&!K&&!Q&&o.jsxs("span",{className:"flex h-2 w-2",children:[o.jsx("span",{className:"animate-ping absolute inline-flex h-2 w-2 rounded-full bg-neon-cyan opacity-75"}),o.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-neon-cyan"})]})]}),o.jsx(j,{variant:"secondary",className:"bg-white/5 hover:bg-white/10 text-muted-foreground font-normal border-0 text-xs px-2",children:s.category}),(A||U>0)&&o.jsx("div",{className:"flex items-center gap-1",children:o.jsxs(j,{className:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20 text-[10px] px-1.5 py-0 gap-1",children:[o.jsx(g,{className:"w-2.5 h-2.5"}),"Ø¹Ø±Ø¨ÙŠ",U>0&&o.jsx("span",{className:"flex gap-0.5 mr-1",children:[...Array(5)].map((e,r)=>o.jsx("span",{className:E("w-1 h-2 rounded-sm",r<Math.ceil(U/2)?"bg-emerald-400":"bg-emerald-400/20")},r))})]})}),R&&o.jsxs(j,{className:"bg-rose-500/10 text-rose-400 border-rose-500/20 text-[10px] px-1.5 py-0 gap-0.5 animate-pulse",children:[o.jsx(f,{className:"w-2.5 h-2.5"}),"Ø¹Ø±Ø¶"]})]})]}),o.jsx("p",{className:"text-muted-foreground/80 text-sm leading-relaxed line-clamp-2 mb-5 flex-1 z-10",children:s.description}),o.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/5 mt-auto z-10",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(B,{rating:s.average_rating,count:s.reviews_count}),o.jsx("span",{className:E("text-xs font-medium px-2 py-0.5 rounded-full border","Ù…Ø¬Ø§Ù†ÙŠ"===s.pricing_type?"text-emerald-400 border-emerald-500/20 bg-emerald-500/5":"text-amber-400 border-amber-500/20 bg-amber-500/5"),children:s.pricing_type})]}),o.jsx(v,{asChild:!0,size:"icon",variant:"ghost",className:E("h-8 w-8 rounded-full transition-colors",K?"hover:bg-amber-500/20 hover:text-amber-400 text-muted-foreground":"hover:bg-neon-purple/20 hover:text-neon-purple text-muted-foreground"),onClick:e=>{e.stopPropagation(),$(s.id)},children:o.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer","aria-label":`Ø²ÙŠØ§Ø±Ø© Ù…ÙˆÙ‚Ø¹ ${s.title}`,children:o.jsx(w,{className:"h-4 w-4"})})})]}),o.jsx("div",{className:E("absolute -right-10 -top-10 w-32 h-32 rounded-full blur-[60px] opacity-0 group-hover:opacity-20 transition-opacity duration-500 pointer-events-none",K?"bg-amber-500":"Ø¨Ø±Ù…Ø¬Ø©"===s.category?"bg-orange-500":"bg-neon-purple")})]})};export{L as T,C as u};
