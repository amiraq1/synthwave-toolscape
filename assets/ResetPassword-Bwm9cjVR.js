import{r as o,j as e}from"./react-core-DF6eTxSH.js";import{B as g}from"./button-M8y5SUea.js";import{I as j}from"./input-DemYJ7a2.js";import{L as w}from"./label-CULsCfRb.js";import{u as C}from"./index-BjzYchjk.js";import{s as d}from"./client-BQnz2r4z.js";import{b as L}from"./router-BDgXhDEa.js";import{m as v,p as I,o as b}from"./icons-D1KRm4qg.js";import{o as A,s as N}from"./forms-BgQR_J8a.js";import"./ui-primitives-B-Kf-2xP.js";import"./supabase-BI1TbgRl.js";import"./tanstack-C82ICjHp.js";const B=A({password:N().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),confirmPassword:N()}).refine(s=>s.password===s.confirmPassword,{message:"كلمتا المرور غير متطابقتين",path:["confirmPassword"]});function T(){const s=new URL(window.location.href),u=s.searchParams.get("code"),i=s.hash?.startsWith("#")?s.hash.substring(1):s.hash,n=new URLSearchParams(i||""),c=n.get("access_token"),l=n.get("refresh_token"),m=n.get("type");return{code:u,accessToken:c,refreshToken:l,type:m}}const J=()=>{const[s,u]=o.useState(""),[i,n]=o.useState(""),[c,l]=o.useState(!1),[m,y]=o.useState(!0),[k,S]=o.useState(!1),r=L(),{toast:a}=C(),p=o.useMemo(()=>T(),[]);o.useEffect(()=>{let t=!1;return(async()=>{try{if(p.code){const{error:f}=await d.auth.exchangeCodeForSession(p.code);if(f){a({title:"رابط غير صالح",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),r("/auth",{replace:!0});return}}const{data:h}=await d.auth.getSession();if(!h.session){a({title:"رابط غير صالح",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),r("/auth",{replace:!0});return}}finally{t||y(!1)}})(),()=>{t=!0}},[r,a,p.code]);const P=async t=>{t.preventDefault(),l(!0);try{const x=B.safeParse({password:s,confirmPassword:i});if(!x.success){a({title:"خطأ في البيانات",description:x.error.errors[0].message,variant:"destructive"});return}const{data:h}=await d.auth.getSession();if(!h.session){a({title:"انتهت صلاحية الرابط",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),r("/auth",{replace:!0});return}const{error:f}=await d.auth.updateUser({password:s});if(f){a({title:"خطأ",description:"حدث خطأ أثناء تغيير كلمة المرور",variant:"destructive"});return}S(!0),a({title:"تم بنجاح!",description:"تم تغيير كلمة المرور بنجاح"})}finally{l(!1)}};return m?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",dir:"rtl",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 text-center space-y-4",children:[e.jsx(v,{className:"mx-auto h-10 w-10 text-neon-purple animate-pulse"}),e.jsx("p",{className:"text-muted-foreground",children:"جاري التحقق من رابط إعادة التعيين…"})]})})}):k?e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center px-4 py-6",dir:"rtl",children:[e.jsx("div",{className:"fixed top-0 left-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-purple/20 rounded-full blur-[120px] -z-10"}),e.jsx("div",{className:"fixed bottom-0 right-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-blue/20 rounded-full blur-[120px] -z-10"}),e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 space-y-8 text-center",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-neon-purple to-neon-blue flex items-center justify-center",children:e.jsx(I,{className:"h-10 w-10 text-foreground"})})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"تم تغيير كلمة المرور!"}),e.jsx("p",{className:"text-muted-foreground",children:"يمكنك الآن تسجيل الدخول باستخدام كلمة المرور الجديدة"})]}),e.jsx(g,{onClick:()=>r("/auth",{replace:!0}),className:"w-full bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 transition-opacity py-6 text-lg",children:"تسجيل الدخول"}),e.jsx("button",{type:"button",onClick:()=>r("/",{replace:!0}),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"العودة للصفحة الرئيسية"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center px-4 py-6",dir:"rtl",children:[e.jsx("div",{className:"fixed top-0 left-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-purple/20 rounded-full blur-[120px] -z-10"}),e.jsx("div",{className:"fixed bottom-0 right-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-blue/20 rounded-full blur-[120px] -z-10"}),e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 space-y-8",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(v,{className:"h-10 w-10 text-neon-purple animate-pulse"}),e.jsxs("h1",{className:"text-3xl",children:[e.jsx("span",{className:"font-extrabold gradient-text",children:"نبض"}),e.jsx("span",{className:"font-medium text-foreground/80 mr-1",children:"AI"})]})]}),e.jsx("p",{className:"text-muted-foreground",children:"إنشاء كلمة مرور جديدة"})]}),e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"password",children:"كلمة المرور الجديدة"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(j,{id:"password",type:"password",placeholder:"••••••••",value:s,onChange:t=>u(t.target.value),className:"pr-10 bg-muted/50 border-border/50",required:!0,autoComplete:"new-password"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(b,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),e.jsx(j,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:i,onChange:t=>n(t.target.value),className:"pr-10 bg-muted/50 border-border/50",required:!0,autoComplete:"new-password"})]})]}),e.jsx(g,{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 transition-opacity py-6 text-lg",children:c?"جاري الحفظ...":"حفظ كلمة المرور"})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:()=>r("/",{replace:!0}),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"العودة للصفحة الرئيسية"})})]})})]})};export{J as default};
