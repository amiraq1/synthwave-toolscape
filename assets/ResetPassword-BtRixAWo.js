import{r as e,j as s,Y as t,a1 as r,$ as a}from"./react-core-Ds-4081u.js";import{B as o}from"./button-0HSBgZKY.js";import{I as n}from"./input-ZFdxA9mo.js";import{L as i}from"./label-CCxDttXb.js";import{u as l}from"./index-CoeHQGik.js";import{s as d}from"./client-CroYBHHp.js";import{b as c}from"./react-router-BmNS8iat.js";import{T as m,U as u}from"./vendor-BS0l4q4C.js";import"./react-dom-CJlssZTM.js";import"./radix-ui-ByoYm48K.js";import"./tanstack-DamGjQ03.js";import"./markdown-01_NS6zS.js";import"./utils-Bmne0XXo.js";import"./supabase-CqVAhX3r.js";const p=m({password:u().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),confirmPassword:u()}).refine(e=>e.password===e.confirmPassword,{message:"كلمتا المرور غير متطابقتين",path:["confirmPassword"]});const x=()=>{const[m,u]=e.useState(""),[x,h]=e.useState(""),[f,j]=e.useState(!1),[g,v]=e.useState(!0),[w,b]=e.useState(!1),N=c(),{toast:y}=l(),k=e.useMemo(()=>function(){const e=new URL(window.location.href),s=e.searchParams.get("code"),t=e.hash?.startsWith("#")?e.hash.substring(1):e.hash,r=new URLSearchParams(t||"");return{code:s,accessToken:r.get("access_token"),refreshToken:r.get("refresh_token"),type:r.get("type")}}(),[]);e.useEffect(()=>{let e=!1;return(async()=>{try{if(k.code){const{error:e}=await d.auth.exchangeCodeForSession(k.code);if(e)return y({title:"رابط غير صالح",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),void N("/auth",{replace:!0})}const{data:e}=await d.auth.getSession();if(!e.session)return y({title:"رابط غير صالح",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),void N("/auth",{replace:!0})}finally{e||v(!1)}})(),()=>{e=!0}},[N,y,k.code]);return g?s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",dir:"rtl",children:s.jsx("div",{className:"w-full max-w-md",children:s.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 text-center space-y-4",children:[s.jsx(t,{className:"mx-auto h-10 w-10 text-neon-purple animate-pulse"}),s.jsx("p",{className:"text-muted-foreground",children:"جاري التحقق من رابط إعادة التعيين…"})]})})}):w?s.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center px-4 py-6",dir:"rtl",children:[s.jsx("div",{className:"fixed top-0 left-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-purple/20 rounded-full blur-[120px] -z-10"}),s.jsx("div",{className:"fixed bottom-0 right-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-blue/20 rounded-full blur-[120px] -z-10"}),s.jsx("div",{className:"w-full max-w-md",children:s.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 space-y-8 text-center",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-neon-purple to-neon-blue flex items-center justify-center",children:s.jsx(r,{className:"h-10 w-10 text-foreground"})})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"تم تغيير كلمة المرور!"}),s.jsx("p",{className:"text-muted-foreground",children:"يمكنك الآن تسجيل الدخول باستخدام كلمة المرور الجديدة"})]}),s.jsx(o,{onClick:()=>N("/auth",{replace:!0}),className:"w-full bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 transition-opacity py-6 text-lg",children:"تسجيل الدخول"}),s.jsx("button",{type:"button",onClick:()=>N("/",{replace:!0}),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"العودة للصفحة الرئيسية"})]})})]}):s.jsxs("div",{className:"min-h-screen bg-background flex items-center justify-center px-4 py-6",dir:"rtl",children:[s.jsx("div",{className:"fixed top-0 left-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-purple/20 rounded-full blur-[120px] -z-10"}),s.jsx("div",{className:"fixed bottom-0 right-1/4 w-72 sm:w-96 h-72 sm:h-96 bg-neon-blue/20 rounded-full blur-[120px] -z-10"}),s.jsx("div",{className:"w-full max-w-md",children:s.jsxs("div",{className:"glass rounded-3xl p-6 sm:p-8 space-y-8",children:[s.jsxs("div",{className:"text-center space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(t,{className:"h-10 w-10 text-neon-purple animate-pulse"}),s.jsxs("h1",{className:"text-3xl",children:[s.jsx("span",{className:"font-extrabold gradient-text",children:"نبض"}),s.jsx("span",{className:"font-medium text-foreground/80 mr-1",children:"AI"})]})]}),s.jsx("p",{className:"text-muted-foreground",children:"إنشاء كلمة مرور جديدة"})]}),s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),j(!0);try{const e=p.safeParse({password:m,confirmPassword:x});if(!e.success)return void y({title:"خطأ في البيانات",description:e.error.errors[0].message,variant:"destructive"});const{data:s}=await d.auth.getSession();if(!s.session)return y({title:"انتهت صلاحية الرابط",description:"يرجى طلب رابط جديد لإعادة تعيين كلمة المرور",variant:"destructive"}),void N("/auth",{replace:!0});const{error:t}=await d.auth.updateUser({password:m});if(t)return void y({title:"خطأ",description:"حدث خطأ أثناء تغيير كلمة المرور",variant:"destructive"});b(!0),y({title:"تم بنجاح!",description:"تم تغيير كلمة المرور بنجاح"})}finally{j(!1)}},className:"space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"password",children:"كلمة المرور الجديدة"}),s.jsxs("div",{className:"relative",children:[s.jsx(a,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),s.jsx(n,{id:"password",type:"password",placeholder:"••••••••",value:m,onChange:e=>u(e.target.value),className:"pr-10 bg-muted/50 border-border/50",required:!0,autoComplete:"new-password"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(i,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور"}),s.jsxs("div",{className:"relative",children:[s.jsx(a,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),s.jsx(n,{id:"confirmPassword",type:"password",placeholder:"••••••••",value:x,onChange:e=>h(e.target.value),className:"pr-10 bg-muted/50 border-border/50",required:!0,autoComplete:"new-password"})]})]}),s.jsx(o,{type:"submit",disabled:f,className:"w-full bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 transition-opacity py-6 text-lg",children:f?"جاري الحفظ...":"حفظ كلمة المرور"})]}),s.jsx("div",{className:"text-center",children:s.jsx("button",{type:"button",onClick:()=>N("/",{replace:!0}),className:"text-sm text-muted-foreground hover:text-foreground transition-colors",children:"العودة للصفحة الرئيسية"})})]})})]})};export{x as default};
