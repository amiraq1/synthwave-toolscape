import{z as e,G as r,I as t,r as a,j as o,E as s,aT as i,aU as n,a0 as l,aV as d,aW as c,aC as m,aX as u,S as p,aY as b,aZ as h,aS as x,a_ as g,$ as f,Z as w,a4 as y,K as v}from"./react-vendor-DJsICmPt.js";import{B as j}from"./badge-BHsni5c_.js";import{B as N}from"./button-B7vBikIo.js";import{b as k,a as _}from"./useClickTracking-Cv-9xw-Z.js";import{s as z}from"./client-Dp-bvcZ2.js";import{u as q}from"./useAuth-DYZ77wHP.js";import{u as E,c as T}from"./index-AG0bShzI.js";const C=()=>{const{user:r}=q();return e({queryKey:["bookmarked-tools",null==r?void 0:r.id],queryFn:async()=>{if(!r)return[];const{data:e,error:t}=await z.from("bookmarks").select("tool_id").eq("user_id",r.id);if(t)throw t;if(!e||0===e.length)return[];const a=e.map(e=>e.tool_id),{data:o,error:s}=await z.from("tools").select("*").in("id",a);if(s)throw s;return o||[]},enabled:!!r})},I=({src:e,alt:r,className:t,placeholderClassName:s,onError:i,width:n,height:l,priority:d=!1})=>{const[c,m]=a.useState(!1),[u,p]=a.useState(d),[b,h]=a.useState(!1),x=a.useRef(null);a.useEffect(()=>{if(d)return;const e=new IntersectionObserver(([r])=>{r.isIntersecting&&(p(!0),e.disconnect())},{rootMargin:"200px",threshold:.01});return x.current&&e.observe(x.current),()=>e.disconnect()},[d]);if(b)return null;const g=e&&!e.includes("wikimedia.org")?e:"";return o.jsxs("div",{ref:x,className:T("relative",t),style:{width:n?`${n}px`:void 0,height:l?`${l}px`:void 0},children:[o.jsx("div",{className:T("absolute inset-0 bg-muted animate-pulse rounded-lg transition-opacity duration-300",s,c?"opacity-0":"opacity-100"),"aria-hidden":"true"}),u&&g&&o.jsx("img",{src:g,alt:r,width:n,height:l,loading:d?"eager":"lazy",decoding:d?"sync":"async",fetchPriority:d?"high":"auto",onLoad:()=>{m(!0)},onError:()=>{h(!0),null==i||i()},className:T("w-full h-full object-contain transition-opacity duration-300",c?"opacity-100":"opacity-0")})]})},S={"Ù†ØµÙˆØµ":u,"ØµÙˆØ±":m,"ÙÙŠØ¯ÙŠÙˆ":c,"Ø¨Ø±Ù…Ø¬Ø©":d,"Ø¥Ù†ØªØ§Ø¬ÙŠØ©":l,"ØµÙˆØª":n,"Ø§Ù„ÙƒÙ„":i},$={"Ù†ØµÙˆØµ":"from-emerald-500/20 to-teal-600/20 text-emerald-400 border-emerald-500/20","ØµÙˆØ±":"from-purple-500/20 to-pink-600/20 text-purple-400 border-purple-500/20","ÙÙŠØ¯ÙŠÙˆ":"from-blue-500/20 to-cyan-600/20 text-blue-400 border-blue-500/20","Ø¨Ø±Ù…Ø¬Ø©":"from-orange-500/20 to-red-600/20 text-orange-400 border-orange-500/20","Ø¥Ù†ØªØ§Ø¬ÙŠØ©":"from-yellow-500/20 to-amber-600/20 text-yellow-400 border-yellow-500/20","ØµÙˆØª":"from-rose-500/20 to-pink-600/20 text-rose-400 border-rose-500/20"},B=({rating:e,count:r})=>{const t="number"!=typeof e||Number.isNaN(e)?0:e,a="number"!=typeof r||Number.isNaN(r)?0:r;return o.jsxs("div",{className:"flex items-center gap-1.5 bg-black/20 px-2 py-1 rounded-md border border-white/5 backdrop-blur-sm",children:[o.jsx(v,{className:"w-3.5 h-3.5 fill-amber-400 text-amber-400"}),o.jsx("span",{className:"text-sm font-semibold tabular-nums text-white/90",children:t.toFixed(1)}),o.jsxs("span",{className:"text-xs text-white/40 hidden sm:inline",children:["(",a,")"]})]})},M=({tool:i,index:n})=>{const l=s(),d=k(),{user:c}=q(),{isBookmarked:m,toggleBookmark:u,isToggling:v}=(()=>{const{user:a}=q(),{toast:o}=E(),s=r(),{data:i=[],isLoading:n}=e({queryKey:["bookmarks",null==a?void 0:a.id],queryFn:async()=>{if(!a)return[];const{data:e,error:r}=await z.from("bookmarks").select("tool_id").eq("user_id",a.id);if(r)throw r;return e},enabled:!!a}),l=i.map(e=>e.tool_id),d=e=>{const r="string"==typeof e?parseInt(e,10):e;return l.includes(r)},c=t({mutationFn:async e=>{if(!a)throw new Error("User not authenticated");const r="string"==typeof e?parseInt(e,10):e;if(d(r)){const{error:e}=await z.from("bookmarks").delete().eq("user_id",a.id).eq("tool_id",r);if(e)throw e;return{action:"removed",toolId:r}}{const{error:e}=await z.from("bookmarks").insert({user_id:a.id,tool_id:r});if(e)throw e;return{action:"added",toolId:r}}},onSuccess:e=>{s.invalidateQueries({queryKey:["bookmarks"]}),o({title:"added"===e.action?"â¤ï¸ ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©":"ðŸ’” ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©",className:"added"===e.action?"bg-rose-500/10 text-rose-500":"bg-muted text-muted-foreground"})},onError:()=>{o({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙØ¶Ù„Ø©",variant:"destructive"})}});return{bookmarkedToolIds:l,isBookmarked:d,toggleBookmark:c.mutate,isToggling:c.isPending,isLoading:n}})(),[C,M]=a.useState(!1),{recordClick:D}=_(),L=$[i.category]||"from-gray-500/20 to-gray-600/20 text-gray-400 border-gray-500/20",F=S[i.category]||p,K=m(i.id),P=!0===i.is_sponsored,U=!0===i.supports_arabic,A=!!i.coupon_code&&(!i.deal_expiry||new Date(i.deal_expiry)>new Date),R=a.useMemo(()=>{if(!i.release_date)return!1;const e=new Date(i.release_date);return Math.floor((Date.now()-e.getTime())/864e5)<=30},[i.release_date]),W=!0===i.is_featured||i.clicks_count&&i.clicks_count>1e3,Z=i.arabic_score??(U?7:0),G=i.image_url&&!C,O=G?null:(e=>{try{return`https://www.google.com/s2/favicons?domain=${new URL(e).hostname}&sz=128`}catch{return null}})(i.url);return o.jsxs("article",{onClick:()=>{l(`/tool/${i.id}`)},onMouseEnter:()=>{d(i.id)},className:T("group relative flex flex-col h-full rounded-2xl p-5 transition-all duration-300 hover:translate-y-[-4px] backdrop-blur-sm cursor-pointer overflow-hidden",P?"bg-gradient-to-br from-amber-500/5 to-yellow-600/5 border-2 border-amber-500/40 hover:border-amber-400/60 shadow-[0_0_20px_-5px_rgba(245,158,11,0.25)] hover:shadow-[0_0_30px_-5px_rgba(245,158,11,0.4)]":"bg-card/30 hover:bg-card/50 border border-white/5 hover:border-white/10 hover:shadow-2xl hover:shadow-neon-purple/5"),style:{animationDelay:50*Math.min(n,6)+"ms"},dir:"rtl",children:[P&&o.jsx("div",{className:"absolute top-3 right-3 z-20",children:o.jsxs(j,{className:"bg-gradient-to-r from-amber-500 to-yellow-500 text-black font-bold text-[10px] px-2 py-0.5 border-0 gap-1",children:[o.jsx(b,{className:"w-3 h-3"}),"Ù…Ù…ÙˆÙ„"]})}),R&&!P&&o.jsx("div",{className:"absolute top-3 right-3 z-20",children:o.jsxs(j,{className:"bg-gradient-to-r from-teal-500 to-cyan-500 text-white font-bold text-[10px] px-2 py-0.5 border-0 gap-1 animate-pulse shadow-[0_0_10px_rgba(20,184,166,0.5)]",children:[o.jsx(h,{className:"w-3 h-3"}),"Ø¬Ø¯ÙŠØ¯"]})}),o.jsx(N,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),c?u(i.id):l("/auth")},disabled:v,"aria-label":K?"Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©":"Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©",className:T("absolute top-3 left-3 z-20 h-9 w-9 rounded-full backdrop-blur-sm transition-all",K?"bg-rose-500/20 text-rose-500 hover:bg-rose-500/30":"bg-black/20 text-white/50 hover:text-rose-500 hover:bg-rose-500/10 opacity-0 group-hover:opacity-100"),children:o.jsx(x,{className:T("w-4 h-4",K&&"fill-current")})}),o.jsxs("div",{className:"flex items-start gap-4 mb-4 z-10",children:[o.jsxs("div",{className:T("w-14 h-14 sm:w-16 sm:h-16 rounded-2xl flex items-center justify-center shrink-0 transition-all duration-500 group-hover:scale-105 group-hover:rotate-3 shadow-lg overflow-hidden","border backdrop-blur-md",P?"border-amber-500/30 bg-gradient-to-br from-amber-500/10 to-yellow-600/10":G?"bg-white/10 border-white/10":`bg-gradient-to-br ${L}`),children:[G?o.jsx(I,{src:i.image_url,alt:i.title,width:64,height:64,className:"w-full h-full p-2 rounded-2xl object-contain",onError:()=>M(!0)}):O?o.jsx("img",{src:O,alt:i.title,className:"w-8 h-8 sm:w-9 sm:h-9 object-contain opacity-90 group-hover:opacity-100 transition-opacity",loading:"lazy",onError:e=>{var r,t;e.currentTarget.style.display="none",null==(t=null==(r=e.currentTarget.parentElement)?void 0:r.querySelector(".fallback-icon"))||t.classList.remove("hidden")}}):null,o.jsx("div",{className:T("fallback-icon absolute inset-0 flex items-center justify-center",G||O?"hidden":"flex"),children:o.jsx(F,{className:"w-7 h-7 sm:w-8 sm:h-8 opacity-90",strokeWidth:1.5})})]}),o.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[o.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[o.jsx("h3",{className:T("text-lg font-bold transition-colors truncate",P?"text-amber-100 group-hover:text-amber-300":"text-white group-hover:text-neon-purple"),children:i.title}),W&&o.jsx("span",{className:"flex items-center gap-0.5 text-orange-400",title:"Ø±Ø§Ø¦Ø¬",children:o.jsx(g,{className:"w-4 h-4 fill-orange-400 animate-pulse"})}),i.is_featured&&!P&&!W&&o.jsxs("span",{className:"flex h-2 w-2",children:[o.jsx("span",{className:"animate-ping absolute inline-flex h-2 w-2 rounded-full bg-neon-cyan opacity-75"}),o.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-neon-cyan"})]})]}),o.jsx(j,{variant:"secondary",className:"bg-white/5 hover:bg-white/10 text-muted-foreground font-normal border-0 text-xs px-2",children:i.category}),(U||Z>0)&&o.jsx("div",{className:"flex items-center gap-1",children:o.jsxs(j,{className:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20 text-[10px] px-1.5 py-0 gap-1",children:[o.jsx(f,{className:"w-2.5 h-2.5"}),"Ø¹Ø±Ø¨ÙŠ",Z>0&&o.jsx("span",{className:"flex gap-0.5 mr-1",children:[...Array(5)].map((e,r)=>o.jsx("span",{className:T("w-1 h-2 rounded-sm",r<Math.ceil(Z/2)?"bg-emerald-400":"bg-emerald-400/20")},r))})]})}),A&&o.jsxs(j,{className:"bg-rose-500/10 text-rose-400 border-rose-500/20 text-[10px] px-1.5 py-0 gap-0.5 animate-pulse",children:[o.jsx(w,{className:"w-2.5 h-2.5"}),"Ø¹Ø±Ø¶"]})]})]}),o.jsx("p",{className:"text-muted-foreground/80 text-sm leading-relaxed line-clamp-2 mb-5 flex-1 z-10",children:i.description}),o.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/5 mt-auto z-10",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(B,{rating:i.average_rating,count:i.reviews_count}),o.jsx("span",{className:T("text-xs font-medium px-2 py-0.5 rounded-full border","Ù…Ø¬Ø§Ù†ÙŠ"===i.pricing_type?"text-emerald-400 border-emerald-500/20 bg-emerald-500/5":"text-amber-400 border-amber-500/20 bg-amber-500/5"),children:i.pricing_type})]}),o.jsx(N,{asChild:!0,size:"icon",variant:"ghost",className:T("h-8 w-8 rounded-full transition-colors",P?"hover:bg-amber-500/20 hover:text-amber-400 text-muted-foreground":"hover:bg-neon-purple/20 hover:text-neon-purple text-muted-foreground"),onClick:e=>{e.stopPropagation(),D(i.id)},children:o.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer","aria-label":`Ø²ÙŠØ§Ø±Ø© Ù…ÙˆÙ‚Ø¹ ${i.title}`,children:o.jsx(y,{className:"h-4 w-4"})})})]}),o.jsx("div",{className:T("absolute -right-10 -top-10 w-32 h-32 rounded-full blur-[60px] opacity-0 group-hover:opacity-20 transition-opacity duration-500 pointer-events-none",P?"bg-amber-500":"Ø¨Ø±Ù…Ø¬Ø©"===i.category?"bg-orange-500":"bg-neon-purple")})]})};export{M as T,C as u};
