import{r as c,j as e}from"./react-core-DF6eTxSH.js";import{b as M,c as O,u as R}from"./tanstack-C82ICjHp.js";import{s as k}from"./client-BQnz2r4z.js";import{B as j}from"./button-M8y5SUea.js";import{B as G}from"./badge-lSgoW4rR.js";import{A as J,a as W,b as X,c as Y,d as Z,e as ee,f as se,g as te}from"./alert-dialog-C3mtGv64.js";import{N as re,F as le}from"./Footer-CyH6YulZ.js";import{u as ae,t as ie,o as oe,b as ne,s as S,l as ce}from"./forms-BgQR_J8a.js";import{u as $}from"./index-BjzYchjk.js";import{u as H}from"./useAuth-Kj5IyosW.js";import{D as de,a as me,b as xe,c as ue,e as he,d as ge}from"./dialog-C_aeRnTz.js";import{F as pe,a as y,b as p,c as f,d as _,e as P,f as V}from"./form-uHxD9lCB.js";import{I as q}from"./input-DemYJ7a2.js";import{T as B}from"./textarea-CdUos4Bm.js";import{S as fe}from"./switch-UhjTwRK9.js";import{L as I,K as L,N as Q,O as K,x as je,T as be,Q as Ne,V as we,u as ve}from"./icons-D1KRm4qg.js";import{u as ye}from"./useAdminCheck-BdETsJDW.js";import{f as _e,a as ke}from"./date-utils-CHNvHV7k.js";import"./supabase-BI1TbgRl.js";import"./ui-primitives-B-Kf-2xP.js";import"./router-BDgXhDEa.js";import"./label-CULsCfRb.js";const De=oe({title:S().min(3,"Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹").max(200),slug:S().optional(),content:S().min(20,"Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹"),excerpt:S().max(300,"Ø§Ù„Ù…Ù„Ø®Øµ Ø·ÙˆÙŠÙ„ Ø¬Ø¯Ø§Ù‹").optional(),image_url:S().url("Ø±Ø§Ø¨Ø· ØºÙŠØ± ØµØ­ÙŠØ­").optional().or(ce("")),is_published:ne()}),U=d=>d.toLowerCase().replace(/[^\u0621-\u064Aa-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim(),Ce=({open:d,onOpenChange:h,postToEdit:l})=>{const{toast:m}=$(),{user:b}=H(),D=M(),[x,u]=c.useState(""),[A,o]=c.useState(!1),[N,w]=c.useState(!1),a=!!l,r=ae({resolver:ie(De),defaultValues:{title:"",slug:"",content:"",excerpt:"",image_url:"",is_published:!0}}),C=r.watch("title");c.useEffect(()=>{!a&&C&&!r.getValues("slug")&&U(C)},[C,a,r]),c.useEffect(()=>{d&&l?(r.reset({title:l.title,slug:l.slug||"",content:l.content,excerpt:l.excerpt||"",image_url:l.image_url||"",is_published:l.is_published}),u(l.image_url||"")):d&&(r.reset({title:"",slug:"",content:"",excerpt:"",image_url:"",is_published:!0}),u(""))},[d,l,r]);const g=r.watch("image_url");c.useEffect(()=>{g?(u(g),o(!1)):u("")},[g]);const F=O({mutationFn:async s=>{const v=s.slug||U(s.title)+"-"+Date.now().toString(36);if(a&&l){const{error:i}=await k.from("posts").update({title:s.title,slug:v,content:s.content,excerpt:s.excerpt||null,image_url:s.image_url||null,is_published:s.is_published}).eq("id",l.id);if(i)throw i}else{const{error:i}=await k.from("posts").insert([{title:s.title,slug:v,content:s.content,excerpt:s.excerpt||null,image_url:s.image_url||null,is_published:s.is_published,author_id:b?.id}]);if(i)throw i}},onSuccess:()=>{m({title:a?"âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«":"ğŸ‰ ØªÙ… Ø§Ù„Ù†Ø´Ø±",className:"bg-emerald-500/10 text-emerald-500"}),D.invalidateQueries({queryKey:["posts"]}),h(!1),r.reset()},onError:s=>{m({title:"Ø®Ø·Ø£",description:s?.message||(a?"ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«":"ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±"),variant:"destructive"})}}),t=()=>{const s=r.getValues("title");s&&r.setValue("slug",U(s))},n=async s=>{const v=s.target.files?.[0];if(v)try{w(!0);const i=v.name.split(".").pop(),z=`${`${crypto.randomUUID()}.${i}`}`,{error:E}=await k.storage.from("blog_images").upload(z,v);if(E)throw E;const{data:{publicUrl:T}}=k.storage.from("blog_images").getPublicUrl(z);r.setValue("image_url",T),u(T),o(!1),m({title:"ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­",className:"bg-emerald-500/10 text-emerald-500"})}catch(i){console.error("Upload error:",i),m({title:"ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹",description:i.message,variant:"destructive"})}finally{w(!1),s.target.value=""}};return e.jsx(de,{open:d,onOpenChange:h,children:e.jsxs(me,{className:"sm:max-w-2xl w-[95vw] max-h-[90vh] flex flex-col p-0 gap-0 overflow-hidden border-white/10 bg-background/95 backdrop-blur-xl",dir:"rtl",children:[e.jsxs(xe,{className:"p-4 pb-2 border-b border-white/5 bg-muted/20 shrink-0",children:[e.jsx(ue,{className:"text-lg font-bold",children:a?"ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„":"Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯"}),e.jsx(he,{className:"text-xs",children:a?"Ù‚Ù… Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø§Ù„":"Ø´Ø§Ø±Ùƒ Ù…Ø¹Ø±ÙØªÙƒ Ù…Ø¹ Ø§Ù„Ù…Ø¬ØªÙ…Ø¹"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:e.jsx(pe,{...r,children:e.jsxs("form",{id:"post-form",onSubmit:r.handleSubmit(s=>F.mutate(s)),className:"space-y-4 pb-4",children:[e.jsx(y,{control:r.control,name:"title",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{className:"text-xs",children:"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„ *"}),e.jsx(_,{children:e.jsx(q,{placeholder:"Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨ Ù„Ù„Ù…Ù‚Ø§Ù„...",...s,className:"h-10 bg-background/50"})}),e.jsx(P,{className:"text-[10px]"})]})}),e.jsx(y,{control:r.control,name:"slug",render:({field:s})=>e.jsxs(p,{children:[e.jsxs(f,{className:"text-xs flex items-center justify-between",children:[e.jsx("span",{children:"Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø®ØªØµØ± (Slug)"}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:t,className:"h-6 text-xs text-neon-purple",children:"ØªÙˆÙ„ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠ"})]}),e.jsx(_,{children:e.jsx(q,{placeholder:"my-post-title",dir:"ltr",...s,className:"h-8 bg-background/50 font-mono text-sm"})}),e.jsx(V,{className:"text-[10px]",children:"ÙŠÙØ³ØªØ®Ø¯Ù… ÙÙŠ Ø±Ø§Ø¨Ø· URL. Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ."})]})}),e.jsxs("div",{className:"space-y-4 border border-white/5 bg-muted/10 p-4 rounded-xl",children:[e.jsxs(p,{children:[e.jsx(f,{className:"text-xs",children:"Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{type:"file",accept:"image/*",className:"bg-background/50 text-xs h-9 cursor-pointer file:text-foreground",onChange:n,disabled:N}),N&&e.jsx("div",{className:"flex items-center justify-center px-3 border border-white/10 rounded-md bg-muted/20",children:e.jsx(I,{className:"h-4 w-4 animate-spin text-neon-purple"})})]})]}),e.jsx(y,{control:r.control,name:"image_url",render:({field:s})=>e.jsxs(p,{children:[e.jsxs(f,{className:"text-xs flex items-center gap-1",children:[e.jsx(L,{className:"w-3 h-3"})," ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù"]}),e.jsx(_,{children:e.jsx(q,{placeholder:"https://...",dir:"ltr",...s,className:"h-8 bg-background/50"})}),e.jsx(P,{className:"text-[10px]"}),e.jsx("div",{className:"mt-2 rounded-lg overflow-hidden border border-white/10 bg-muted/20 aspect-video flex items-center justify-center",children:x&&!A?e.jsx("img",{src:x,alt:"Ù…Ø¹Ø§ÙŠÙ†Ø©",className:"w-full h-full object-cover",onError:()=>o(!0)}):e.jsxs("div",{className:"text-muted-foreground text-xs flex flex-col items-center gap-2",children:[e.jsx(L,{className:"w-8 h-8 opacity-30"}),e.jsx("span",{children:A?"Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± ØµØ­ÙŠØ­":"Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©"})]})})]})})]}),e.jsx(y,{control:r.control,name:"excerpt",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{className:"text-xs",children:"Ù…Ù„Ø®Øµ Ù‚ØµÙŠØ±"}),e.jsx(_,{children:e.jsx(B,{placeholder:"Ù…Ù„Ø®Øµ Ù…Ø®ØªØµØ± ÙŠØ¸Ù‡Ø± ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...",...s,className:"min-h-[60px] bg-background/50 resize-none text-sm"})}),e.jsx(P,{className:"text-[10px]"})]})}),e.jsx(y,{control:r.control,name:"content",render:({field:s})=>e.jsxs(p,{children:[e.jsx(f,{className:"text-xs",children:"Ø§Ù„Ù…Ø­ØªÙˆÙ‰ *"}),e.jsx(_,{children:e.jsx(B,{placeholder:"Ø§ÙƒØªØ¨ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„ Ù‡Ù†Ø§...",...s,className:"min-h-[200px] bg-background/50 resize-none text-sm"})}),e.jsx(P,{className:"text-[10px]"})]})}),e.jsx(y,{control:r.control,name:"is_published",render:({field:s})=>e.jsxs(p,{className:"flex items-center justify-between rounded-lg border border-white/10 p-3 bg-muted/10",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{className:"text-sm",children:"Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„"}),e.jsx(V,{className:"text-xs",children:"Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ØŒ Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹"})]}),e.jsx(_,{children:e.jsx(fe,{checked:s.value,onCheckedChange:s.onChange})})]})})]})})}),e.jsxs(ge,{className:"p-4 border-t border-white/5 bg-background shrink-0 flex-row gap-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>h(!1),className:"flex-1 h-9",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(j,{type:"submit",form:"post-form",disabled:F.isPending,className:"flex-1 h-9 bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90",children:F.isPending?e.jsx(I,{className:"w-4 h-4 animate-spin"}):a?"Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª":"Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„"})]})]})})},Xe=()=>{const[d,h]=c.useState(!1),[l,m]=c.useState(null),[b,D]=c.useState(null);H();const{isAdmin:x}=ye(),{toast:u}=$(),A=M(),{data:o,isLoading:N,error:w}=R({queryKey:["posts"],queryFn:async()=>{const t=k.from("posts").select("*").order("created_at",{ascending:!1});x||t.eq("is_published",!0);const{data:n,error:s}=await t;if(s)throw s;return n}}),a=O({mutationFn:async t=>{const{error:n}=await k.from("posts").delete().eq("id",t);if(n)throw n},onSuccess:()=>{u({title:"ğŸ—‘ï¸ ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­",className:"bg-red-500/10 text-red-500"}),A.invalidateQueries({queryKey:["posts"]}),D(null)},onError:()=>{u({title:"Ø®Ø·Ø£",description:"ÙØ´Ù„ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„",variant:"destructive"})}}),r=(t,n=150)=>{const s=t.excerpt||t.content;return s.length<=n?s:s.substring(0,n).trim()+"..."},C=t=>{m(t),h(!0)},g=()=>{m(null),h(!0)},F=t=>{h(t),t||m(null)};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",dir:"rtl",children:[e.jsx(re,{onAddClick:g}),e.jsxs("main",{className:"flex-1 container mx-auto max-w-7xl px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold gradient-text mb-2",children:"Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©"}),e.jsx("p",{className:"text-muted-foreground",children:"Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø± Ø¹Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ"})]}),x&&e.jsxs(j,{onClick:g,className:"bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯"]})]}),N&&e.jsx("div",{className:"flex justify-center items-center py-20 min-h-[400px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(I,{className:"h-12 w-12 animate-spin text-neon-purple"}),e.jsx("span",{className:"text-muted-foreground animate-pulse",children:"Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª..."})]})}),w&&e.jsxs("div",{className:"text-center py-20 min-h-[400px] flex flex-col justify-center items-center",children:[e.jsx("div",{className:"bg-destructive/10 p-4 rounded-full mb-4",children:e.jsx(K,{className:"h-8 w-8 text-destructive"})}),e.jsx("p",{className:"text-xl font-bold text-destructive mb-2",children:"Ø­Ø¯Ø« Ø®Ø·Ø£"}),e.jsx("p",{className:"text-muted-foreground",children:"ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª"})]}),!N&&!w&&(!o||o.length===0)&&e.jsxs("div",{className:"text-center py-20 min-h-[400px] flex flex-col justify-center items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-muted/50 rounded-2xl flex items-center justify-center mb-4 text-3xl opacity-50",children:"ğŸ“"}),e.jsx("p",{className:"text-xl font-semibold text-foreground",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹"}),e.jsx("p",{className:"text-muted-foreground mt-2 max-w-xs mx-auto",children:"ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ Ù…Ù‚Ø§Ù„Ø§Ù‹!"}),x&&e.jsxs(j,{onClick:g,className:"mt-6 bg-gradient-to-r from-neon-purple to-neon-blue hover:opacity-90 gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Ø£Ø¶Ù Ø£ÙˆÙ„ Ù…Ù‚Ø§Ù„"]})]}),!N&&!w&&o&&o.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(t=>e.jsxs("article",{className:"group relative glass-card rounded-2xl overflow-hidden border border-white/5 hover:border-neon-purple/30 transition-all duration-300 hover:shadow-lg hover:shadow-neon-purple/10",children:[x&&e.jsxs("div",{className:"absolute top-3 left-3 z-10 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>C(t),className:"h-8 w-8 bg-background/80 backdrop-blur-sm hover:bg-neon-purple/20 hover:text-neon-purple",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>D(t),className:"h-8 w-8 bg-background/80 backdrop-blur-sm hover:bg-destructive/20 hover:text-destructive",children:e.jsx(be,{className:"w-4 h-4"})})]}),x&&!t.is_published&&e.jsxs(G,{className:"absolute top-3 right-3 z-10 bg-yellow-500/20 text-yellow-500 border-yellow-500/30",children:[e.jsx(Ne,{className:"w-3 h-3 mr-1"}),"Ù…Ø³ÙˆØ¯Ø©"]}),t.image_url&&e.jsx("div",{className:"aspect-video overflow-hidden bg-muted/20",children:e.jsx("img",{src:t.image_url,alt:t.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500",loading:"lazy"})}),!t.image_url&&e.jsx("div",{className:"aspect-video bg-gradient-to-br from-neon-purple/20 to-neon-blue/20 flex items-center justify-center",children:e.jsx(K,{className:"w-12 h-12 text-muted-foreground/30"})}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-3",children:[e.jsx(we,{className:"w-3 h-3"}),e.jsx("time",{dateTime:t.created_at,children:_e(new Date(t.created_at),"PPP",{locale:ke})})]}),e.jsx("h2",{className:"text-lg font-bold text-foreground mb-2 line-clamp-2 group-hover:text-neon-purple transition-colors",children:t.title}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:r(t)}),e.jsxs("button",{className:"mt-4 text-sm font-medium text-neon-purple hover:text-neon-blue transition-colors flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4"}),"Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ø²ÙŠØ¯"]})]})]},t.id))})]}),e.jsx(le,{}),e.jsx(Ce,{open:d,onOpenChange:F,postToEdit:l}),e.jsx(J,{open:!!b,onOpenChange:t=>!t&&D(null),children:e.jsxs(W,{dir:"rtl",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ"}),e.jsxs(Z,{children:['Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„ "',b?.title,'" Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.']})]}),e.jsxs(ee,{className:"flex-row-reverse gap-2",children:[e.jsx(se,{children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(te,{onClick:()=>b&&a.mutate(b.id),className:"bg-destructive hover:bg-destructive/90",disabled:a.isPending,children:a.isPending?e.jsx(I,{className:"w-4 h-4 animate-spin"}):"Ø­Ø°Ù"})]})]})})]})};export{Xe as default};
